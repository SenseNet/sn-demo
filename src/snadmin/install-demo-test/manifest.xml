<Package type='Install'>
  <Id>SenseNet.Demo.Test</Id>
  <Description>sensenet Demo for testing</Description>
  <ReleaseDate>2019-11-22</ReleaseDate>
  <Version>1.0.0</Version>
  <Dependencies>
    <Dependency id='SenseNet.Services' minVersion='7.6.1' />
  </Dependencies>
  <Parameters>
  </Parameters>
  <Steps>

    <Phase>
      <IfXmlNodeExists file="./web.config" xpath="/configuration/configSections/sectionGroup[@name='sensenet']/section[@name='contentNaming']">
        <Then>
         <!-- Do nothing -->
        </Then>
        <Else>
          <AppendXmlFragment file="web.config" xpath="/configuration/configSections/sectionGroup[@name='sensenet']">
            <Source>
              <section name="contentNaming" type="System.Configuration.NameValueSectionHandler" />
            </Source>
          </AppendXmlFragment>
        </Else>
    </IfXmlNodeExists>

    <IfXmlNodeExists file="./web.config" xpath="/configuration/sensenet/contentNaming/add[@key='InvalidNameCharsPattern']">
        <Then>
         <!-- Do nothing -->
        </Then>
        <Else>
         <AppendXmlFragment file="web.config" xpath="/configuration/sensenet">
            <Source>
              <contentNaming>
                <add key="InvalidNameCharsPattern" value="[\$&amp;\+,/:;=?&quot;&lt;&gt;\#%{}|\\^~\[\u005D'â€™`\*\t\r\n]"/>
              </contentNaming>
            </Source>
          </AppendXmlFragment>
        </Else>
    </IfXmlNodeExists>

    <IfXmlNodeExists file="./web.config" xpath="/configuration/sensenet/identityManagement/add[@key='DefaultDomain']">
        <Then>
         <!-- Do nothing -->
        </Then>
        <Else>
          <AppendXmlFragment file="web.config" xpath="/configuration/sensenet/identityManagement">
            <Source>
              <add key="DefaultDomain" value="Public"/>
            </Source>
          </AppendXmlFragment> 
        </Else>
    </IfXmlNodeExists>   

      <StartRepository startWorkflowEngine="false" />

      <Import target="/Root" LogLevel="Verbose" source="import" />
      
      <!-- DemoWorkspace type related settings -->

      <EditAllowedChildTypes path="/Root" add="DemoWorkspace" />
      <EditAllowedChildTypes path="/Root/Content" add="DemoWorkspace" />
      <SetPermissions path="/Root/System/Schema/ContentTypes/GenericContent/Folder/Workspace/DemoWorkspace" identity="/Root/IMS/BuiltIn/Portal/Everyone" allow="See" />

    </Phase>
  </Steps>
</Package>
