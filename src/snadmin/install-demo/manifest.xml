<Package type='Install'>
  <Id>SenseNet.Demo</Id>
  <Description>sensenet ECM Demo</Description>
  <ReleaseDate>2017-08-01</ReleaseDate>
  <Version>7.0.0</Version>
  <Dependencies>
    <Dependency id='SenseNet.Services' minVersion='7.0.0' />
  </Dependencies>
  <Parameters>
  </Parameters>
  <Steps>
    <Phase>
      <Copy targetDirectory='.' source='bin' />
      
      <!-- Enable this in the first phase so that it takes effect in the second: demo user profiles should be created during import. -->
      <EditXmlNodes file="Tools\SnAdminRuntime.exe.config" xpath="/configuration/sensenet/identityManagement/add[@key='UserProfilesEnabled']/@value">
        <Source>true</Source>
      </EditXmlNodes>
    </Phase>
    
    <Phase>
      <AppendXmlFragment file="web.config" xpath="/configuration/configSections/sectionGroup[@name='sensenet']">
        <Source>
          <section name="contentNaming" type="System.Configuration.NameValueSectionHandler" />
        </Source>
      </AppendXmlFragment>
      <AppendXmlFragment file="web.config" xpath="/configuration/sensenet">
        <Source>
          <contentNaming>
            <add key="InvalidNameCharsPattern" value="[\$&amp;\+,/:;=?&quot;&lt;&gt;\#%{}|\\^~\[\u005D'â€™`\*\t\r\n]"/>
          </contentNaming>
        </Source>
      </AppendXmlFragment>
      <AppendXmlFragment file="web.config" xpath="/configuration/sensenet/identityManagement">
        <Source>
          <add key="DefaultDomain" value="Public"/>
        </Source>
      </AppendXmlFragment>     

      <StartRepository startWorkflowEngine="false" />

      <EditJson Path="/Root/System/Settings/UserProfile.settings">
        {
          User: {
            ProfileType: "DemoProfile",
            ProfilesTarget: "/Root"
          }
        }
      </EditJson>

      <!-- This is added because we want to use smartfolders in user profile workspace doclibs. -->
      <EditAllowedChildTypes contentType="DocumentLibrary" add="SmartFolder" />
      
      <Import target="/Root" LogLevel="Verbose" source="import" />

      <!-- Add DMS related scenarios into the Scenario field. -->
      <SetField name="Scenario" content="/Root/(apps)/GenericContent/Logout"><![CDATA[UserActions,DMSUserActions]]></SetField>
      <SetField name="Scenario" content="/Root/(apps)/GenericContent/Rename"><![CDATA[ListItem;ExploreActions;ManageViewsListItem,DMSListItem]]></SetField>
      <SetField name="Scenario" content="/Root/(apps)/GenericContent/MoveTo"><![CDATA[ListItem;ExploreActions;ManageViewsListItem,DMSListItem]]></SetField>
      <SetField name="Scenario" content="/Root/(apps)/GenericContent/CopyTo"><![CDATA[ListItem;ExploreActions;ManageViewsListItem,DMSListItem]]></SetField>
      <SetField name="Scenario" content="/Root/(apps)/GenericContent/Delete"><![CDATA[ListItem;ExploreActions;ManageViewsListItem,DMSListItem]]></SetField>
    </Phase>
  </Steps>
</Package>